# [컴퓨터 네트워킹 하향식 접근] CHAPTER 8. 네트워크 계층: 데이터 평면

## 4.1 네트워크 계층 개요
**네트워크 계층:** 송신 호스트에서 수신 호스트로 패킷을 전달하는 역할
- 데이터 평면: 입력 링크에서 출력 링크로 데이터그램을 전달
- 제어 평면: 데이터그램이 잘 전달되도록 로컬 포워딩, 라우터별 포워딩을 대응.

**포워딩과 라우팅**
- 포워딩: 패킷이 라우터의 입력 링크에 도달했을 때, 패킷을 적절한 출력 링크로 이동시킴. 나노초 단위로 하드웨어에서 실행
- 라우팅: 패킷 전송 시 패킷 경로를 결정. 네트워크 전반에 걸쳐 출발지부터 목적지까지의 데이터그램의 종단 간 경로를 결정하는 초 단위로 소프트웨어에서 실행

라우팅 알고리즘은 라우터의 포워딩 테이블의 내용을 결정하는데, 각각의 모든 라우터에서 라우팅 알고리즘이 실행되며 모든 라우터는 포워딩과 라우팅 기능을 모두 갖고 있어야 함

**네트워크 서비스 모델:** 송수신 호스트 간 패킷 전송 특성을 정의, 네트워크 계층은 최선형 서비스(best-office service)를 제공
- 네트워크 계층 제공 서비스: 보장된 전달, 지연 제한 이내의 보장된 전달, 순서화 패킷 전달, 최소 대역폭 보장, 보안 서비스
- 최선형 서비스는 순서 보장, 보장된 전달, 종단 시스템 간 지연 보장, 최소 대역폭 보장이 없으나, 적절한 애플리케이션 레벨의 프로토콜과 결합되어 충분히 좋은 성능을 입증

## 4.2 라우터 내부 구조

**라우터 내부 구조**
- 입력포트:     입력 링크-미들박스-검색 기능 수행.     
  포워딩 테이블을 사용해 도착 패킷이 스위치 구조를 통해 전달되는 출력 포트를 검색.   
  최장 프리픽스 매치 규칙 사용.  
  물리 및 링크 계층 처리, 패킷의 버전 번호, 체크섬, TTL 필드 확인 후 다시 사용, 카운터 갱신 등.  
  매치 플러스 액션
- 스위치 구조: 라우터의 핵심으로, 입력 포트와 출력 포트를 연결.   
  메모리, 버스, 상호연결 네트워크-크로스바 스위치
- 출력 포트: 출력 링크로 패킷 전송
- 라우팅 프로세서: 제어 평면 기능, 네트워크 관리 기능 수행

**포워딩**
- 목적지 기반 포워딩: 라우터에 도착한 데이터그램이 데이터그램의 최종 목적지만을 기준으로 출력 인터페이스로 포워딩
- 일반화된 포워딩: 라우터가 데이터그램의 출력 인터페이스를 결정할 때 최종 목적지 외에도 데이터그램과 관련된 다른 요소들도 고려. 매치 플러스 액션

**큐잉:**
- 입력 큐잉: HOL
- 출력 큐잉: 패킷 스케쥴링(FIFO, 우선순위 큐잉, 라운드로빈, WFQ)
- 버퍼: 버퍼가 길수록 큐잉 지연이 길어진다. 버퍼블로트   
  B = RTT * C -> B = RTT * C / N*(1/2)

## 4.3 IPv4, IPv6
**데이터그램 포맷**
- IPv4 vs IPv6
- IPv4 주소 공간의 빠른 고갈
- 확장된 주소기능, 간소화된 헤더, 흐름 레이블링 => IPv6
- IPv4 -> IPv6? 터널링

**주소 체계**
- 모든 호스트와 라우터의 각 인터페이스는 고유한 IP 주소를 가짐
- 주소 집약(경로 집약, 경로 요약): 외부에 알 필요가 없는 여러 네트워크를 알리기 위해 하나의 네트워크 프리픽스 사용
- 서브넷, 서브넷 마스크
- 주소 할당 방식: 클래스 주소체계 -> CIDR
- 주소 블록 획득: ISP, ICANN(최상위 기관)
- DHCP: 플러그 앤 플레이, 제로 구성 프로토콜
- 네트워크 주소 변환(NAT): NAT 변환 테이블 사용. NAT 라우터는 외부 세계로는 하나의 IP 주소를 갖는 하나의 장비로 동작

## 4.4 일반화된 포워딩 및 SDN

**매치 플러스 액션**
- 매치: 목적지 IP 주소 찾기
- 액션: 패킷을 스위치 구조로 지정된 출력 포트로 전송. 패킷 전달 외에도 로드 밸런싱, 헤더값 재작성, 패킷 차단/삭제 등의 추가 처리 작업을 위한 특수 서버로의 패킷 전송 등의 작업 수행
- SDN: 일반화된 포워딩 채택(포워딩 결정은 데이터그램의 TCP/UDP 소스 또는 목적지 포트 번호를 기반으로 할 수 있으며, 목적지 IP 주소 외에도 데이터그램의 TCP/UDP 소스 또는 목적지 포트 번호를 기반으로 할 수 있음), 원격 컨트롤러를 통해 구현되고 테이블이 계산, 설치, 갱신
- OpenFlow의 플로우 테이블

## 4.5 미들박스
**미들 박스:** 출발지 호스트와 목적지 호스트 사이의 데이터 경로에서 IP 라우터의 정상적이고 표준적인 기능과는 별도로 기능을 수행
- NAT 변환
- 보안 서비스: 방화벽, DPI, IPS
- 성능 향상: 압축, 로드 밸런싱

**네트워크 기능 가상화(NFV):** 일반적인 소프트웨어 스택 위에 구축된 전문화된 소프트웨어와 함께 사용할 수 있는 하드웨어의 사용 탐구 (?)