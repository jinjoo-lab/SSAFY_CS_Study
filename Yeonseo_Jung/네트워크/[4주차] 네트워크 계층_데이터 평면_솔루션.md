# [컴퓨터 네트워킹 하향식 접근] CHAPTER 8. 네트워크 계층: 데이터 평면

## 1. 네트워크 계층과 평면
### 네트워크 계층의 역할과 두 개 평면에 대해 다음의 키워드를 포함하여 간략히 작성해주세요.
**[포워딩, 라우팅, 소프트웨어, 하드웨어]**
> **네트워크 계층**: 송신 호스트에서 수신 호스트로 패킷을 전달. 포워딩과 라우팅 기능 수행   
> **제어 평면 (Control Plane)** 라우팅 테이블을 관리하고 최적의 경로를 결정하는 라우팅 알고리즘을 실행하는 소프트웨어 기능   
> **데이터 평면 (Data Plane)** 수신된 패킷을 목적지로 전달하는 실제 패킷 전송을 담당하는 하드웨어 기능 (가상화된 환경이나 소규모 네트워크에서는 데이터 평면이 소프트웨어로 구현될 수 있음)  

> **포워딩** 패킷이 라우터의 입력 링크에 도달했을 때, 패킷을 적절한 출력 링크로 이동시키는 것을 의미, 나노초 단위로 하드웨어에서 실행     
> **라우팅**은 패킷 전송 시 패킷 경로를 결정하는데 네트워크 전반에 걸쳐 출발지부터 목적지까지의 데이터그램의 종단 간 경로를 결정, 초 단위로 소프트웨어에서 실행  

## 2. 라우터의 구조
### 2-1. [그림1]을 바탕으로 라우터 내부 구조를 간략하게 설명해주세요. 
![image](https://github.com/yeondori/SSAFY_CS_Study/assets/93027942/2e502f2b-a64f-4bd8-a373-44c333f80aa5)
> 라우터는 (1)입력 포트, (2)스위치 구조, (3)출력 포트, (4)라우팅 프로세서로 구성  
> **입력 포트** 라우터에 도착한 패킷들이 입력되는 포트로 여러 입력 포트가 있을 수 있고, 각 포트는 다른 네트워크 장치로부터 패킷을 받는다. 미들 박스에서는 들어오는 링크 반대편의 링크 계층과 상호 운용을 위해 필요한 링크 계층을 수행하고, 우측 박스에서는 포워딩 테이블을 참조해 라우터 출력 포트를 검색하고 결정한다. 이때 포워딩 테이블은 라우팅 프로세서에서 섀도 복사본을 사용하므로 병목 현상을 피할 수 있으며 목적지 주소는 프리픽스를 테이블의 엔트리와 매치하여 다수의 매치가 있는 경우는 최장 프리픽스 매치 규칙을 사용한다.  
> **스위치 구조**  라우터의 입력 포트와 출력 포트를 연결하며 스위칭은 라우터의 핵심이다. (a)메모리를 통한 교환과 (b)버스를 통한 교환, (c)상호연결 네트워크를 통한 교환으로 크게 구분된다.  
> **출력 포트**  스위치 구조에서 수신한 패킷을 저장하고, 패킷 스케줄링 및 큐 제거와 필요한 링크 계층 및 물리 계층 기능을 수행해 출력 링크로 패킷을 전송한다.    
> **라우팅 프로세서**  제어 평면 기능을 수행한다. 기존의 라우터는 라우팅 프로토콜을 실행해 라우팅 테이블과 연결된 링크 상태 정보를 유지 관리하며 포워딩 테이블을 계산하고, SDN의 경우 원격 컨트롤러와 통신하여 포워딩 테이블 엔트리를 수신하고 입력 포트에 엔트리를 설치한다.

> **스위칭 구조 추가 설명**  
> **메모리 스위칭**: 입력 포트로 들어온 패킷은 먼저 메모리에 저장되고, 그 후 출력 포트로 전송된다. 입력  포트에 도착한 패킷을 라우팅 프로세스가 포워딩 테이블에서 적절한 출력 포트를 찾은 뒤 출력 포트의 버퍼에 패킷을 복사한다. 목적지 포트가 다른 경우라도 공유 시스템 버스를 통해 한번에 하나의 메모리 읽기/쓰기 작업을 수행하기 때문에 두 패킷을 동시에 전달할 수 없다.    
> **공유 버스**: 입력 포트는 라우팅 프로세서의 개입 없이 내부 레이블이 나타내는 패킷에게 전송되거나 로컬 공유 버스를 통해 직접 출력 포트로 패킷을 전송한다. 모든 출력 포트에 패킷이 수신되지만 레이블과 매치되는 포트만 패킷을 유지한다. 버스는 한 번에 하나의 패킷만 전송할 수 있어서 여러 패킷이 동시에 전송되는 경우 각각의 패킷은 순차적으로 버스를 이용하여 전송된다. 라우터의 교환 속도는 버스 속도에 의해 제한된다.     
> **크로스바 스위치**: N개의 입력 포트를 N개의 출력 포트에 연결하는 2N버스로 구성된 상호연결 네트워크. 입력 포트와 출력 포트를 연결하는 크로스바 스위치는 병렬로 여러 입력 포트로부터 여러 출력 포트로 패킷을 동시에 전송할 수 있다. 각 입력 포트와 출력 포트 간에는 독립적인 전용 경로가 있으므로 충돌 없이 여러 패킷을 동시에 전송할 수 있다.  

### 2-2. 정확히 같은 시간에 2개의 패킷이 서로 다른 (1)에 도착했을 때, [그림2]의 a,b,c의 경우 서로 다른 2개의 (3)으로 동시에 전달이 가능한가요? 
> **(a)메모리**와 **(b)공유 버스**의 경우에는 동시에 여러 패킷이 전달될 수 **없다.** 메모리와 공유 버스를 사용하는 경우에는 하나의 패킷이 한 번에 전달되고, 다음 패킷은 전달이 완료된 후에 처리된다. 버스의 대역폭이 한정되어 있거나, 메모리의 처리 속도가 제한되어 있기 때문에 여러 입력 포트로부터 도착한 패킷들은 순차적으로 처리된다.    
> 한편, **(c)크로스바 스위치**는 여러 입력 포트로부터 여러 출력 포트로 패킷을 동시에 전달할 수 있는 구조로, 각 입력 포트와 출력 포트 사이에 독립적인 전용 경로를 설정하여 패킷이 충돌하지 않고 동시에 전달될 수 있도록 한다. 따라서 서로 다른 입력 포트로부터 온 패킷들이 서로 다른 출력 포트로 전달될 때 동시에 처리될 수 **있다.** 단, 동일한 출력포트로는 동시에 전달할 수 없다.

### 2-3. 패킷을 전송하는 시간을 D라고 했을 때, D의 함수로서 (a), (b), (c) 구조에서 패킷의 최대 지연은 얼마인가요? (단, 모든 패킷은 다른 출력 포트로 전달되며 입력 라인 및 출력 라인의 전송률과 각 구조의 전송률이 같다고 가정)
> **(a) 메모리** (N-1)*D: 모든 패킷이 각각 다른 출력 포트로 전달되므로, 첫 번째 패킷은 전송에 D 시간이 걸리고, 두 번째 패킷은 D 시간이 걸리는 동안 대기. 두 번째 패킷은 첫 번째 패킷이 전송되는 동안 대기해야 하므로 추가적인 (N-1) * D의 지연 발생  
> **(b) 공유 버스** (N-1)*D: 모든 패킷이 하나의 버스를 공유하므로, 한 번에 하나의 패킷만 전송.두 번째 이후의 패킷은 각각의 패킷이 버스를 통해 전송될 때까지 이전 패킷들이 버스를 점유하고 있어야 하므로 (N-1) * D의 추가적인 지연 발생    
> **(c) 크로스바 스위치** 0: 병렬로 여러 입력 포트와 출력 포트 간의 연결을 제공하므로, 모든 패킷이 동시에 다른 출력 포트로 전송될 수 있다. 추가적인 지연이 발생하지 않고, 모든 패킷이 각각의 D 시간에 전송 


## 3.큐잉
### 3-1. 다음의 그림이 설명하는 현상에 대해 간략하게 서술해주세요. 
![image](https://github.com/yeondori/SSAFY_CS_Study/assets/93027942/b945aa20-c125-4589-8228-3defa7ca2431)
> **HOL(head-of-the-line) 블로킹** 이동하려는 출력 링크가 경쟁이 없는 상태임에도 불구하고 앞의 패킷때문에 대기해야 하는 상황. 입력 링크에서 패킷 도착 속도가 용량의 58%가 되면 이러한 HOL 차단 때문에 입력 큐가 무한정 길이로 증가하고, 패킷 손실이 증가하게 된다.

> **[보충]** 예를 들어, 스위치의 출력 포트에서 목적지로 전송되는 패킷 중 하나가 전송되지 않고 대기하고 있는 경우, 이후에 도착한 모든 패킷은 그 패킷 뒤에서 대기해야 한다. 이로 인해 전송 지연이 발생하고 네트워크 성능이 저하될 수 있다.   
> **해결** 이러한 HOL 블로킹을 완화하기 위해 스위치나 라우터에서는 여러 가지 기술을 사용한다. 예를 들어, 패킷 스케줄링 알고리즘을 사용하여 우선순위가 높은 패킷이 먼저 전송되도록 하거나, 패킷 버퍼의 크기를 조정하여 큐잉 지연을 최소화할 수 있다. 또한, Active Queue Management (AQM) 알고리즘을 사용하여 네트워크 혼잡을 관리하고 패킷 손실을 줄일 수 있다.
### 3-2. 출력 포트에서 스위치 구조가 포트 라인 속도보다 N배 빠른 경우에 패킷 큐잉이 발생하나요?
> 스위치 구조 전송률이 라인 전송률보다 N배 빠르며 N개의 입력 포트 각각에 도착하는 패킷이 동일한 출력 포트로 향하는 것을 가정하자. 출력 링크에 단일 패킷을 보내는 데 걸리는 시간에 N개의 새로운 패킷이 출력 포트에 도착하고, 출력 포트는 패킷 전송 시간에 단일 패킷만을 전송할 수 있으므로 N개의 도착 패킷은 전송 큐에서 대기해야 한다. 대기 중인 N개의 패킷을 전송하는 동안 다시 N개의 새로운 패킷이 도착할 수 있으므로 스위치 구조가 포트 라인 속도보다 N배 빠르더라도 패킷 큐잉이 발생할 수 있다.  
> 이때 패킷을 저장할 메모리가 충분하지 않은 경우 도착한 패킷을 삭제하는 drop-tail 정책이나 대기 중인 하나 이상의 패킷을 제거해 공간을 확보한다. 또는 버퍼가 가득 차기 전에 혼잡 신호를 제공(ECN)할 수도 있다. - AQM 알고리즘

### 3-3. [RFC 3439]에서 버퍼 크기는 링크 용량이 C일 때 $RTT*C$ 이나, 최근에는 $RTT*C/N^(1/2)$ 로 제안되고 있습니다. 버퍼의 크기와 큐잉 지연, 패킷 손실은 어떤 관계가 있나요?
> 버퍼가 클수록 큐잉 지연이 길어진다. 패킷 손실을 줄이기 위해 버퍼의 양을 늘리면 종단 간 지연이 이에 비례해 증가하며, 증가된 RTT는 TCP 송신자의 초기 혼잡 및 패킷 손실에 대한 응답 속도를 떨어뜨린다. 버퍼블로트(bufferbloat) [참조](https://www.itworld.co.kr/news/100874?page=0,2)

## 4.IPv4 vs IPv6
### 다음의 IPv4의 데이터 그램 포맷을 참조하여 IPv4와 IPv6을 비교해주세요.
![image](https://github.com/yeondori/SSAFY_CS_Study/assets/93027942/8bde0e48-686b-42ab-a18f-1ab2265a4e8d)

> **IPv4**   
> 주소 길이: 32비트 주소를 사용하여 약 43억 개의 주소를 제공   
> 헤더 포맷: 가변 길이 헤더를 사용하여 기능과 옵션을 지원  
> NAT(Network Address Translation): 주소 부족 문제를 해결하기 위해 NAT를 사용  
> 호환성: 현재 대부분의 네트워크 장비와 응용 프로그램이 IPv4를 지원  

> **IPv6**  
> 주소 길이: 128비트 주소를 사용하여 약 340경 개의 주소를 제공  
> 헤더 포맷: 고정 길이 40바이트 헤더를 사용하여 간소화  
> NAT: 주소 부족 문제를 해결하고, 라우팅 및 보안을 개선하기 위해 NAT를 최소화  
> 보안: IPsec 기능이 내장되어 있어 데이터 보안이 강화(데이터의 기밀성, 무결성 및 인증을 제공하여 보안 측면에서 IPv4보다 우수한 보안 기능을 제공) 
> 호환성: IPv4와의 호환성을 유지하면서 IPv6로의 전환을 지원  

> **IPv6에 도입된 변화**
> 1. 확장된 주소 기능: 주소를 32비트에서 128비트로 확장
> 2. 간소화된 헤더: IPv4의 많은 필드가 생략되거나 옵션으로 남겨졌으며 기존의 가변 헤더에 비해 40바이트 고정 길이 헤더로 보다 빠른 IP 데이터그램 처리가 가능해짐
> 3. 흐름 레이블링: 20비트 필드로 데이터그램의 흐름을 인식하는데 사용. 비 디폴트 품질 서비스나 실시간 서비스 같은 특별한 처리를 요청하는 송신자에 대해 특정 흐름에 속하는 패킷 레이블링이 가능
> 
> **제거/변경된 필드**
> 1. 단편화/재결합: IPv6는 단편화와 재결합을 출발지와 목적지만 수행해 IP 전달 속도를 증가시킴
> 2. 헤더 체크섬: 네트워크 계층의 체크섬 기능은 IP 패킷의 빠른 처리를 위해 생략. 트랜스포트 계층 프로토콜과 데이터 링크 프로토콜에서 체크섬 수행
> 3. 옵션: 표준 IP 헤더 필드에서 제거되었으며 다음 헤더 필더에 속할 수는 있다.


## 5.DHCP
### DHCP 프로토콜의 4단계에 대해 설명해주세요.
![image](https://github.com/yeondori/SSAFY_CS_Study/assets/93027942/7015fa93-6d8c-4f42-b4eb-b0a53f4841dc)
> 1. **DHCP 서버 발견:** 호스트는 DHCP 발견 메시지를 포함하는 IP 데이터그램을 생성해 출발지 주소는 0.0.0.0으로, 목적지 주소는 브로드 캐스트 255.255.255.255로 링크 계층에 전송. 이때 서브넷에 연결된 모든 노드로 브로드캐스트  
> 2. **DHCP 서버 제공:** DHCP 발견 메시지를 받은 DHCP 서버가 DHCP 제공 메시지와 트랜잭션 ID, IP주소, 네트워크 마스크, IP 주소 임대기간을 포함해 응답. 이때도 브로드캐스트 주소를 사용해 서브넷의 모든 노드로 메시지를 브로드캐스트(서브넷에는 여러 DHCP 서버가 존재하며 클라이언트는 가장 최적에 위치에 있는 서버를 선택)  
> 3. **DHCP 요청:**  호스트(클라이언트)는 하나 이상의 서버 제공자 중에서 하나를 선택해 DHCP 요청 메시지로 응답
> 4. **DHCP ACK:** 서버는 DHCP 요청 메시지에 대해 요청된 파라미터를 확인하는 DHCP ACK 메시지로 응답. 클라이언트가 이를 수신하면 상호작용은 종료되고 클라이언트는 할당받은 IP 주소를 임대 기간동안 사용할 수 있다

> **DHCP** 
> 동적 호스트 구성 프로토콜로, 호스트가 네트워크에 연결될 때 IP 주소 및 기타 네트워크 구성 정보를 동적으로 할당하는 데 사용. 
> DHCP 서버는 클라이언트에게 IP 주소, 서브넷 마스크, 기본 게이트웨이, DNS 서버 등을 할당. DHCP는 네트워크 관리를 단순화하고 IP 주소 할당의 효율성을 높인다.
> DHCP를 사용하면 네트워크 관리가 단순화되고 IP 주소 할당이 자동화되어 효율적으로 관리됩니다.(중복된 IP 주소 할당을 방지하고, 호스트의 이동이나 네트워크 변경 시 IP 주소를 쉽게 재할당)