# [2주차] TCP와 UDP의 차이점

---

TCP, UDP 를 설명하기에 앞서 복잡한 인터넷 망에서 메시지가 수많은 노드를 거쳐 어떤 규칙으로 전달되는지를 이해하려면 **IP(Internet Protocol)** 를 먼저 알아야 한다.
## IP
IP는 지정한 IP 주소에 데이터를 전달할 수 있도록 하는 규칙이며 패킷(Packet)이라는 통신 단위로 데이터가 전달된다.   
데이터를 전송하는 측을 클라이언트, 수신하는 측을 서버라고 하자.  
클라이언트는 전송하고자 하는 데이터를 출발지 IP와 목적지 IP를 포함해 IP 패킷에 담아 서버에게 전달하고, 패킷을 전달받은 서버는 동일한 방식으로 OK 패킷을 클라이언트에게 전달한다. 
### 한계
그러나 이러한 방식만으로는 다음과 같은 한계가 있다.
#### 1. 비연결성
패킷을 받을 대상이 없거나 서비스 불능 상태여도 패킷을 전송할 수 있다.
#### 2. 비신뢰성
중간에 패킷이 사라지거나 패킷이 순서대로 도착하지 않는 경우가 발생할 수 있다.
#### 3. 프로그램 구분
같은 IP를 사용하는 서버에서 통신하는 애플리케이션이 둘 이상일 수 있다.

이러한 문제를 해결해주는 것이 **TCP**이다.

--- 
## OSI 7 Layer, TCP/IP 4 Layer
### OSI 7 Layer
![image](https://velog.velcdn.com/images%2Fyooni%2Fpost%2F407905c6-696c-4597-8bf8-b5a831d7b67e%2Fimage.png)
통신 과정에서의 호환성 문제를 막기 위해, 데이터를 주고 받는 네트워크 과정을 여러 계층으로 세분화하여 OSI 7 Layer로 만들어 표준으로 지정.   
통신의 흐름을 이해하기 쉬워진 것 뿐만 아니라, 각 계층은 담당하는 위치마다 그 역할이 구분되어 있기 때문에 서로간의 간섭이 최소화되어 네트워크 통신의 편리성을 높일 수 있다.  
또한 통신 장애가 발생했을 때, 다른 계층을 건드리지 않고 문제가 생긴 계층만 고치면 되기 때문에 유지보수성이 높아진다.

IP 프로토콜보다 높은 계층인 전송 계층에 TCP 프로토콜이 존재하므로 IP 프로토콜의 한계를 보완할 수 있다.
### TCP/IP 4 Layer
![image](https://github.com/yeondori/SSAFY_CS_Study/assets/93027942/60ffc07d-1b4c-4191-a54e-422bae31834a)
OSI 7 Layer가 단순화된 버전으로, 사실상 표준이다.  
TCP/IP 4 계층은 OSI 7 계층보다 먼저 개발되었으며 TCP/IP 프로토콜의 계층은 OSI 모델의 계층과 정확하게 일치하지는 않는다.


**OSI 7계층** 은 데이터 통신의 과정을 7개의 계층으로 분류한 모델, **TCP/IP 4계층**은 실제로 사용되는 프로토콜 스택

---
## TCP
![image](https://github.com/yeondori/SSAFY_CS_Study/assets/93027942/949a0138-760c-4c54-a395-3c899a650d10)
앞선 문제를 해결하기 위해 IP 패킷 안에 출발지 port, 목적지 port, 전송 제어, 순서 검증 정보 등 TCP 관련 정보가 추가된다.

TCP는 **전송 제어 프로토콜(Transmission Control Protocol)** 로 신뢰할 수 있는 프로토콜이며, 현재는 대부분의 애플리케이션에서 TCP를 사용한다.   
### 특징 
TCP는 다음과 같은 특징이 있다.
#### 1. 연결지향 - TCP 3 way handshake (가상 연결)
TCP 3 way handshake는 
1. 클라이언트에서 서버로 SYN(접속 요청)
2. 서버에서 클라이언트로 SYN + ACK(요청 수락) 
3. 클라이언트가 서버로 ACK 

하는 세 번의 메시지 전달 과정으로 연결이 된다.   
그러나 이때의 연결은 물리적인 연결이 아닌 논리적인 가상 연결이다.   
이러한 방식으로 연결이 된 후에야 데이터를 전송하기 때문에 연결이 없는 상태에서는 패킷을 전송하지 않는다. 
참고로 현재는 최적화되어 3번 ACK와 함께 데이터 전송이 가능하다.

[TCP_HandShake.md]([2주차]TCP_HandShake.md)

#### 2. 데이터 전달 보증
TCP에서는 데이터를 전송하면 서버에서 데이터를 받은 경우 이를 알려준다.   
따라서 만약 요청이 전송되었는데 서버에서 응답이 없다면, 메시지가 전달 도중 누락이 되었다고 알 수 있게 된다.

#### 3. 순서 보장
클라이언트에서 보낸 순서대로 패킷이 오지 않은 경우, 서버에서는 순서가 잘못된 부분부터 패킷을 다시 요청한다.  
이러한 특징은 모두 TCP 패킷 내부에 출발지 port, 목적지 port, 전송 제어, 순서 검증 정보 등 TCP 관련 정보가 포함되어 있기 때문에 가능하다.

### 작동 방식 
![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fd69O64%2FbtryDbH914W%2Fr9Yddx69rWBX9Wzt3squXK%2Fimg.png)  
서버와 클라이언트가 **1:1**로 연결되어 다중 전송이 불가하다.  
데이터 패킷을 전송해 클라이언트에 도착하면 재조립하는 방식으로 작동한다.  
데이터가 순차적으로 전송되기 대문에 데이터 혼잡과 흐름 제어에 도움이 되며 오류를 쉽게 발견하고 수정할 수 있는 반면 많은 양의 통신이 오가므로 시간이 오래 걸린다.

**가상 회선 방식**
![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbdXn7q%2FbtryFpF5YLG%2FnYPuXgwbOMrqE4ySgp7G9k%2Fimg.png)
데이터를 전송하기 전에 논리적 연결이 설정된다.  
처음 패킷으로 최적의 경로를 고정하고, 경로가 고정되면 패킷으로 나누어 고속으로 전송하는 기술이다.  
각 패킷에는 가상회선 식별 번호(VCI)가 포함되고, 모든 패킷을 전송하면 가상 회선이 해제되고 패킷들은 전송된 순서대로 도착한다.
패킷마다 라우터가 경로를 선택하는 데이터그램과는 달리 경로를 설정할 때 한번만 수행한다.  
네트워크 내의 한 노드가 다운되면 그 노드를 지나는 모든 가상회선을 잃는다.  
정해진 시간 안에 다량의 데이터를 연속으로 보낼 때는 가상 회선 방식이 적합하다. 

--- 
## UDP
**User Datagram Protocol**, 즉 UDP는 TCP와 같이 IP 계층 바로 위에 있는 프로토콜이다.   

### 특징
**비연결 방식**으로 수신자와 발신자 간에 사전 연결을 설정하지 않기 때문에 데이터가 손실될 가능성이 있지만 훨씬 빠른 속도를 얻을 수 있다.    
IP와 거의 같으나 PORT와 체크섬(데이터 손상 검증) 정도만 추가된 정도이기 때문에, 이미 많이 구축되어 있어 최적화가 어려운 TCP와는 달리, 최적화하고자 할 때 사용된다.
TCP와는 달리 고유 식별자나 시퀀스 번호 없이 데이터 전송 작업을 수행한다.
오류가 발생하기 쉽지만 TCP보다 훨씬 빠르다.

### 작동 방식
![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fcctzr7%2FbtryCPTyj6V%2FUwjTIAENhoMY1VRkitFMmK%2Fimg.png)  
비연결형 서비스로 일방적으로 데이터를 보내기만 하면 되므로 1:1뿐만 아니라 **1:N, N:N** 도 전송이 가능하다.

**데이터그램**
![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbsrU5g%2FbtryHJXWJjs%2F1r6o4YQoWNg0nFoyo7NkG0%2Fimg.png)
연결을 위해 할당되는 논리적인 경로가 없고, 각각의 패킷은 다른 경로로 전송되며 **독립적**이다.  
짧은 메시지의 일시적인 전송에 적합하며 네트워크 내의 한 노드가 다운되면 다른 경로를 새로 설정한다.  
송신 측에서 전송한 순서와 수신 측에 도착한 순서가 다를 수 있다.

---
## TCP와 UDP의 공통점
Transport 계층에 있는 프로토콜로, Network 계층에 있는 IP 주소와 함께 전송된 패킷 데이터를 세그먼트로 Session 계층에 전달하는 역할을 한다.

## TCP와 UDP의 차이점
|          | **TCP**                                                                                                                   | **UDP**                                                                                                                                                        |
|:---------|:--------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 특징       | **연결** 기반 - 데이터를 전송하는 동안 수신자와 발신자 간 연결 설정 및 유지<br/>1:1 통신 방식<br/>전이중(전송이 양방향으로 동시에 일어날 수 있다), 점대점(각 연결이 정확히 2개의 종단점을 가진다) | **비연결** 기반 - 수신자와 발신자 간에 사전 연결을 설정하지 않음<br/>1:1, 1:N, N:N 통신 방식                                                                                                |
| 패킷 교환 방식 | 가상 회선 방식                                                                                                                  | 데이터그램 방식                                                                                                                                                       |
| 장점       | **신뢰성**이 높음, 데이터가 완전히 안전하게 도착하도록 보장 <br/>운영체제와 독립적으로 작동<br/>전송 순서 보장<br/> 전송 실패의 경우 재전송 시도                                | **빠르고 간단**함<br/>더 작은 패킷을 더 적은 오버헤드로 전송(end-to-end 지연 줄임)<br/>일부 패킷이 누락되어도 데이터를 전송해 전체 전송이 중단되지 않음<br/>브로드캐스트 및 멀티캐스트 기능으로 하나의 UDP 전송을 여러 수신자에게 한번에 전송          |
| 단점       | **느린 속도**<br/>데이터의 일부가 손실되면 나머지 데이터도 로드되지 않을 수 있음<br/>근거리 통신망이나 개인 영역 네트워크에서 제대로 작동하지 않을 수 있음                             | 데이터 패킷이 목적지에 성공적으로 도착했는지의 여부 모름<br/>전송이 온전하게 도찬다고 보장할 수 없음. 일부 패킷이 손실되더라도 알 수 없음<br/>라우터가 데이터 패킷의 우선순위를 정해야 하는 경우 UDP보다 TCP 패킷을 먼저 전송할 가능성이 높음<br/>순서가 보장되지 않음 |
| 사용 예시    | 신뢰성 있는 전송이 중요한 이메일 전송,웹 검색 등                                                                                              | 연속성이 중요한 실시간 스트리밍 서비스                                                                                                                                          |

---
# Reference
[모든 개발자를 위한 HTTP 웹 기본 지식](https://www.inflearn.com/course/http-%EC%9B%B9-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC)  
[TCP와 UDP 차이: 두 프로토콜 비교](https://nordvpn.com/ko/blog/tcp-udp-comparison/)    
[데이터그램과 가상회선](https://security-nanglam.tistory.com/179)  
[OSI 7계층, TCP/IP 4계층](https://velog.io/@yooni/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-OSI-7%EA%B3%84%EC%B8%B5-TCPIP-4%EA%B3%84%EC%B8%B5-OSI-7%EA%B3%84%EC%B8%B5-TCP-vs-UDP)
