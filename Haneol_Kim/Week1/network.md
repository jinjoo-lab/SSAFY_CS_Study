# 브라우저에 google.com을 치면?

## 용어정리

- 리다이렉트 : re + direct 즉 다시 지하는것을 말하며, www.ssafy/abc URL을 웹 서버에 요청했을때 서버는 http로 www.ssafy/def를 다시 요청해봐 라고 다시 지시하는 것을 리다이렉트라고 한다.
- 캐싱 : 파일 복사본을 캐시 또는 임시 저장 위치에 저장하여 보다 빠르게 엑세스 할 수 있도록 하는 프로세스이다.
- dns(Domain Name System) :  IP주소 및 기타 데이터를 저장하고 이름별로 쿼리할 수 있게 해주는 계층형 분산 데이터베이스 시스템으로, FQDN을 인터넷 프로토콜인 ip로 바꿔준다.
- FQDN(Fully Qualified Domain Name) : 호스트와 도메인이 합쳐진 완전한 도메인 이름을 말한다.(www 부분은 호스트부분 [google.com](http://google.com) 은 도메인이라고 한다.)
- URL vs FQDN : URL 이 더 큰 범위
- 라우팅 : 네트워크 안에서 통신 데이터를 보낼 때 최적의 경로를 선택하는 과정이다.
- 라우터 : 라우터는 전용회선을 통해 LAN에 연결된 컴퓨터들이 동시에 인터넷을 사용할 수 있게 해주는 장비로 데이터를 목적지까지 전달하는 기능을 수행하며 2개 이상의 서로 다른 네트워크를 접속하고 이들 간 데이터를 주고 받게하는 중계 기능도 한다.
- TCP 요청 : 두개의 호스트를 연결하고 데이터 스트림을 교환하게 해주는 중요한 네트워크 프로토콜입니다.
- Domain Name Space : 도메인 주소를 어떻게 관리할지에 대한 규칙
- 네임 서버 : 도메인 주소를 관리하기 위해 사용하는 DNS 전용 서버
- 리졸버 : 네임서버에게 도메인 주소에 IP주소를 물어보는 장비 또는 프로그램

### 순서

1. 리다이렉트
2. 캐싱
3. dns
4. IP 라우팅
5. TCP 요청

## 1  리다이렉트

리다이렉트가 있다면 리다이렉트를 진행하고 없다면 그 다음 진행 과정으로 넘어갑니다.

## 2  캐싱

해당 요청이 캐싱이 가능한지 파악을 합니다. 만약 캐싱이 이미 된 요청이라면 캐싱된 값을 반환하며 캐싱이 도지 않은 새로운 요청이라면 다음 단계로 넘어갑니다. 이때 캐시에 종류는 두가지가 있습니다.,

- 브라우저캐시 : 브라우저 캐시는 우리가 흔히 아는 쿠키, 로컬스토리지를 포함하는 개인 캐시입니다. 브라우저 자체가 http를 통해 다운로드 하는 문서를 보유하고 있는것(ex : 인터넷 사용기록을 삭제하면 처음 google등을 접속할 때 느려지는데 이게 캐시를 삭제해서 그렇습니다.)
- 공유캐시 : 클라이언트와 서버 사이에 있으며 사용자 간에 공유할 수 있는 응답을 저장할 수 있다. 대표적인게 서버 앞단에 프록시 서버를 예로 듭니다.

## 3 DNS

FQDN을 인터넷 프로토콜인 IP로 바꿔주는 시스템이다. 이는 DNS 관련 요청을 네임 서버로 전달하고 해당 응답값을 클라이언트에게 전달하는 리졸버, 도메인을 IP로 변환하는 네임 서버 등으로 이루어져 있다.

구성요소 : 도메인 네임 스페이스. 네임서버, 리졸버

### 도메인 주소 구조

주소 해석은 오른쪽에서부터 시작하며, 오른쪽에 있을 수록 상위 주소이다.

도메인 종류

- 루트 도메인 (Root Domain)
    - 네임 스페이스에서 이름 해석의 출발지 역할을 수행하는 노드(서버)
    - 최상위 도메인 서버의 정보를 가지고 있다.
    - 전 세계에 13개의 원본 root 서버가 존재
- 최상위 도메인 (Top Level Domain = TLD)
    - 국가 코드 최상이 도메인 (ccTLD : country code TLD)
        - .kr, .jp 등
    - 일반 최상위 도메인 (gTLD = global TLD)
        - .net, .com, org 등
    - ARPA : 역방향 조회 시 사용되는 최상위 도메인
        - in-addr.arpa
- 2차 도메인 (Second Level Domain, Sub Domain)
    - TLD 하위에서 관리되는 서브 도메인
    - 국가 도메인 하위에 기관 유형에 따른 분류
        - .co (일반회사), .ac (교육기관), .go (정부기관) 등
- 서브 도메인 (Sub Domain)
    - 상위 도메인에 소속되는 각 기관 또는 회사별 도메인
        - ex : google, naver 등

### 작동 방식

1. 로컬 DNS 캐시를 확인하여 로컬 DNS캐시에 해당 도메인 이름에 대한 IP 주소가 캐시되어 있다면 IP 주소를 반환, 만약 없다면 DNS질의 시작
2. 최상위 DNS 서버의 IP 주소를 참조하여 루트 DNS 서버의 IP 주소를 IP주소를 획득
3. 루트 DNS 서버에 질의를 보내어, 해당 도메인 이름을 관리하는 TLD DNS서버의 IP주소를 얻는다.
4. TLD DNS 서버에 질의를 보내어, 해당 도메인 이름을 관리하는 Authoritative DNS서버의 IP 주소 획득
5. Authoritative DNS 서버에 질의를 보내어, 해당 도메인 이름에 대한 IP 주소 획득
6. 획득한 IP 주소를 캐시에 저장 및, 이를 브라우저에 반환하여 해당 도메인 이름에 대한 웹페이지를 표시

## 4 IP 라우팅

해당 IP를 기반으로 라우팅, ARP 과정을 거쳐 실제 서버를 찾는다.

### 라우팅 종류

### 1) 정적라우팅(Static Routing)

관리자에 의해 수동으로 라우팅 경로가 설정되는 것을 말합니다. 라우팅 오버헤드가 적고 심플해서 네트워크 토폴로지가 변하지 않는 단순한 네트워크에 적당합니다. 관리자가 수동으로 Static Route를 업데이트해야 기본적으로 다른 라우터에 전파되지 않습니다. 정적 라우팅 단점은 네트워크 환경변화에 능동적으로 대처하지 못한다는 점입니다. 관리자가 늘 환경 변화에 대처를 해야 합니다.

### 2) 디폴트 라우팅(Default Routing)

디폴트 라우팅은 라우팅 테이블안에 없는 원격 네트워크 수신지로 하는 패킷을 다음 홉(Hop)까지 라우터로 전송하기 위한 방법을 말합니다. 이럴 경우 어떤 특정한 라우터를 기본 라우터로 지정하고 목적지를 모르는 경우 그곳으로 기본 경로를 만들어주는 것이 일반적입니다. 그리고 스터브(Stub) 네트워크상에서만 디폴트 라우트를 사용할 수 있으며, 즉 한 개의 출구 포트만을 네트워크상에서 사용할 수 있습니다.

### 3) 동적 라우팅(Dynamic Routing)

라우터 라우팅 경로가 주변의 라우터와 라우팅 프로토콜에 의해 설정이 되는 형태를 말합니다. 정적 라우팅과는 달리 라우팅 프로토콜이 작동하면 네트워크 토폴로지의 변화가 인접라우터에 전달되어 자동으로 업데이트됩니다. 네트워크 토폴로지가 자주 변경되는 복잡한 네트워크에 적당합니다. 목적지까지 도달하는 경로가 2개 이상 존재할 경우 하나의 경로가 단절되어도 나머지 경로를 통해 패킷이 전달될 수 있습니다.

## 5 TCP 연결 구축

브라우저가 TCP 3웨이 핸드셰이크 및 SSL 연결등을 통해 연결합니다.

### 3-way handshake란 ?

- **TCP 통신을 이용하여 데이터를 전송하기 위해 네트워크 연결을 설정(Connection Establish)하는 과정**
- 양쪽 모두 데이터를 전송할 준비가 되었다는 것을 보장하고, 실제로 데이터 전달이 시작하기 전에 한 쪽이 다른 쪽이 준비되었다는 것을 알 수 있도록 한다.
- 즉, TCP/IP 프로토콜을 이용해서 통신을 하는 응용 프로그램이 데이터를 전송하기 전에 먼저 정확한 전송을 보장하기 위해 상대방 컴퓨터와 사전에 세션을 수립하는 과정을 의미한다.

A 프로세스(Client)가 B 프로세스(Server)에 연결을 요청

**a. A -> B: SYN**

- 접속 요청 프로세스 A가 연결 요청 메시지 전송 (SYN)
- 송신자가 최초로 데이터를 전송할 때 Sequence Number를 임의의 랜덤 숫자로 지정하고, SYN 플래그 비트를 1로 설정한 세그먼트를 전송한다.
- PORT 상태 - B: LISTEN, A: CLOSED

**b. B -> A: SYN + ACK**

- 접속 요청을 받은 프로세스 B가 요청을 수락했으며, 접속 요청 프로세스인 A도 포트를 열어 달라는 메시지 전송 (SYN + ACK)
- 수신자는 Acknowledgement Number 필드를 (Sequence Number + 1)로 지정하고, SYN과 ACK 플래그 비트를 1로 설정한 세그먼트를 전송한다.
- PORT 상태 - B: SYN_RCV, A: CLOSED

**c. A -> B: ACK**

- PORT 상태 - B: SYN_RCV, A: ESTABLISHED
- 마지막으로 접속 요청 프로세스 A가 수락 확인을 보내 연결을 맺음 (ACK)
- 이때, 전송할 데이터가 있으면 이 단계에서 데이터를 전송할 수 있다.
- PORT 상태 - B: ESTABLISHED, A: ESTABLISHED

### 4-way handshaking (연결 해제 과정)

![https://velog.velcdn.com/images%2Fragnarok_code%2Fpost%2F1804bed2-b0e2-4b0b-b622-84ea78c6fb96%2F%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-11-21%20%EC%98%A4%ED%9B%84%202.36.17.png](https://velog.velcdn.com/images%2Fragnarok_code%2Fpost%2F1804bed2-b0e2-4b0b-b622-84ea78c6fb96%2F%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-11-21%20%EC%98%A4%ED%9B%84%202.36.17.png)

4-way handshake란 ?

- TCP의 연결을 해제(Connection Termination)하는 과정

A 프로세스(Client)가 B 프로세스(Server)에 연결 해제를 요청

**a. A -> B: FIN**

- 프로세스 A가 연결을 종료하겠다는 FIN 플래그를 전송
- 프로세스 B가 FIN 플래그로 응답하기 전까지 연결을 계속 유지

**b. B -> A: ACK**

- 프로세스 B는 일단 확인 메시지를 보내고 자신의 통신이 끝날 때까지 기다린다.(이 상태가 TIME_WAIT 상태)
- 수신자는 Acknowledgement Number 필드를 (Sequence Number + 1)로 지정하고, ACK 플래그 비트를 1로 설정한 세그먼트를 전송한다.
- 그리고 자신이 전송할 데이터가 남아있다면 이어서 계속 전송한다.

**c. B -> A: FIN**

- 프로세스 B가 통신이 끝났으면 연결 종료 요청에 합의한다는 의미로 프로세스 A에게 FIN 프래그를 전송

**d. A -> B: ACK**

- 프로세스 A는 확인했다는 메시지를 전송
