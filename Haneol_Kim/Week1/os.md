# 프로세스와 쓰레드의 차이

## 용어정리

- 프로세스 : 프로그램을 실행 시켜 정적인 프로그램이 동적으로 변하여 프로그램이 돌아가고 있는 상태 or 운영체제로부터 자원을 할당받은 작업의 단위 최소 한개의 쓰레드는 반드시 존재한다.
- 쓰레드 : 프로스세 내에서 동시에 진행되는 작업 갈래, 흐름의 단위를 말한다.
- 공유자원 : 시스템 내에서 각 프로세스, 스레드가 함께 접근할 수 있는 메모리, 파일, 데이터 등의 자원이나 변수를 의미한다.
- 멀티프로세스 : 운영체제에서 하나의 응용 프로그램에 대해 동시에 여러개의 프로세스를 실행할 수 있게 하는 기술을 말한다.
- 멀티스레딩 : 하나의 프로세스에서 둘 이상의 스레드가 동시에 작업을 수행하는 것
- 가상메모리 : 물리적 메모리 크기의 한계를 극복하기 위해 나온 기술로, 프로세스 실행을 위한 일부만 메모리에 로드하고 나머지는 디스크에 두는것이다.(프로세스는 한개의 가상 메모리를 가지며, 스레드는 프로세스의 가상메모리를 나눠 가지게 된다. 다만 프로세스에서 디스크에 있는 데이터가 필요할 경우 이는 반드시 메모리에 로드 되어야 한다.)
- 병렬성 : 실제 작업들을 동시에 수행하는것 멀티코어에서 멀티 쓰레드를 동작시키는 방식
- 동시성 : 동시에 실행되는 것 같이 보이는 것 실질적으로는 한번에 하나의 작업만을 처리한다. 싱글 코어에서 멀티 쓰레드를 동작시키는 방식
- Context Switching : CPU가 현재 작업중인 프로세스에서 다른 프로세스로 넘어갈 때, 이전의 프로세스 정보를 PCB에 저장하고 새롭게 실행할 프로세스의 정보를 PCB에서 읽어와 레지스터에 적재하는 과정을 말한다.

##스레드의 등장

하나의 작업을 멀티프로세스로 처리하게 될 경우 중복된 자원이 생기게 되고 이는 메모리 성능을 저하시켰다 이러한 프로세스의 한계를 해결하기 위해 탄생하였다.

##스레드의 가장 큰 특징

- 프로세스 내에서 동시에 진행되는 작업 갈래, 흐름의 단위를 말한다.

- 메모리의 개별 스택영역을 가지며 코드영역, 데이터 영역, 힙 영역을 공유한다.

*******프로세스는 하나의 가상메모리를 가지는데 스레드 들은 프로세스가 가지고 있는 가상메모리 영역을 공유한다.*******

##멀티 프로세싱

멀티 프로세싱이란 하나의 프로그램을 여러 개의 프로세스가 구성하여 각 프로세스가 작업(Task)를 처리하도록 하는 기법이다.

***특징***

- 여러개의 자식 프로세스 중 하나에 문제가 발생해도 다른 자식 프로세스는 영향을 받지 않는다.
- Context Switching 과정에서 캐쉬 메모리 초기화 등 무거운 작업이 진행되면서 오버헤드가 발생한다.
- 프로세스 간 통신을 하기 위해서는 IPC를 통해야 한다.
- 프로세스 간 공유하는 메모리가 없어서 Context Switching이 발생하면 데이터를 처음부터 불러와야 한다.

##멀티스레딩

- 멀티스레딩이란 하나의 응용프로그램을 여러 개의 스레드로 구성하고 각 스레드가 하나의 작업을 처리하도록 하는 것이다.

- 윈도우나 리눅스 등 많은 OS에서 멀티 프로세싱도 지원하지만 멀티 스레딩을 기본으로 하고 있다.

***특징***

- 시스템 자원 소모 감소 (자원의 효율성)
    - 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어서 자원을 효율적으로 관리할 수 있다.
- 시스템 처리량 감소 (처리 비용)
    - 스레드 간 데이터를 주고 받는 것이 간단해지면서 시스템 자원 소모가 줄어든다.
    - 스레드 사이의 작업량이 작아 스레드 간 Context Switching이 활발하게 일어난다.

***단점***

- Thread-Safety에 문제가 없는 지 확실한 설계가 필요하다.
- 디버깅이 까다롭다.
- 동기화나 교착 상태가 발생할 수 있다.
- 프로세스 밖에서는 해당 스레드를 제어할 수 없다.
- 하나의 스레드가 문제가 발생하면 프로세스 전체가 영향을 받는다.

## PCB ( Process control block )

- 운영체제가 프로세스를 제어하기 위해 정보(CPU 레지스터 값들)를 저장해 놓는 곳으로 프로세스의 상태 정보를 저장하는 구조체이다
    
    운영체제가 프로세스 스케줄링을 위해 프로세스에 관한 모든 정보를 가지고 있는 데이터베이스이다
    
- 각 프로세스가 생성될 때마다 고유의 PCB가 생성되고, 프로세스가 완료되면 PCB는 제거된다.
- 프로세스는 CPU를 점유하여 작업을 처리하다가도 상태가 전이되면, 진행하던 작업 내용들을 모두 정리하고 CPU를 반환해야 하는데, 이때 진행하던 작업들을 모두 저장하지 않으면 다음에 자신의 순서가 왔을 때 어떠한 작업을 해야하는지 알 수 없는 사태가 발생한다.
    - > 프로세스는 CPU가 처리하던 작업의 내용들을 자신의 PCB에 저장하고, 다음에 다시 CPU를 점유하여 작업을 수행해야 할 때 PCB로부터 해당 정보들을 CPU에 넘겨와서 계속해서 하던 작업을 진행할 수 있게 된다.
- PCB 는 프로세스의 중요한 정보들을 담고 있으므로 일반 사용자는 접근하지 못하는 보호된 메모리 영역에 존재
- PCB에 저장되어 있는 정보
    
    1) 프로세스 식별자(Process ID) : 프로세스 고유 번호
    
    2) 프로세스 상태(Process State) : 생성(create), 준비(ready), 실행 (running), 대기(waiting), 완료(terminated)
    
    3) 프로그램 계수기(Program Counter) : 프로그램 계수기는 이 프로세스가 다음에 실행할 명령어의 주소를 가리킵니다.
    
    4) CPU 레지스터 및 일반 레지스터 : CPU(Central Processing Unit)가 요청을 처리하는 데 필요한 데이터를 일시적으로 저장하는 기억장치
    
    5) CPU 스케줄링 정보 : 우선 순위, 최종 실행시각, CPU 점유시간 등
    
    6) 메모리 관리 정보 : 해당 프로세스의 주소 공간 등
    
    7) 프로세스 계정 정보 : 페이지 테이블, 스케줄링 큐 포인터, 소유자, 부모 등
    
    8) 입출력 상태 정보 : 프로세스에 할당된 입출력장치 목록, 열린 파일 목록 등
    
    9) 포인터 : 부모프로세스에 대한 포인터, 자식 프로세스에 대한 포인터, 프로세스가 위치한 메모리 주소에 대한 포인터, 할당된 자원에 대한 포인터 정보 등. 프로세스가 준비상태나 대기 상태일 경우에 큐로 운영이 되는데, 프로세스 제어 블록을 연결 시 큐로 구현하기 위해 포인터를 사용한다.
    

**TCB (Thread Control Block)**

스레드를 관리하는 자료구조

- 구조
    
    1) **스레드 ID** : 스레드가 생성될 때 운영 체제에서 스레드에 할당하는 고유 식별자
    
    2) **스레드 상태**: 스레드가 시스템을 통해 진행됨에 따라 변경되는 스레드의 상태
    
    3) **CPU 정보**: 스레드가 얼마나 진행되었는지, 어떤 데이터가 사용되고 있는지 등 OS가 알아야 하는 모든 정보가 포함스레드
    
    4) **우선 순위**: 스레드 스케줄러가 READY 대기열에서 다음에 선택해야 하는 스레드를 결정하는 데 도움이 되는 다른 스레드에 대한 스레드의 가중치(또는 우선 순위)
    
    5) **PCB를 가리키는 포인터** : 이 스레드 생성을 트리거한 프로세스를 가리키는 포인터
    
    6) **이 스레드가 생성한 스레드를 가리키는 포인터**
    
    7) **stack 포인터** ( stack : 스레드가 함수 호출할때 저장하는 곳)
    
- 메모리영역 중 PCB는 커널 영역TCB는 유저영역과 커널 영역에 둘다 있을 수 있다.
