# Packet

## 패킷이란?

- 네트워크에서 출발지와 목적지간에 라이팅되는 데이터의 단위
- 정보를 보낼 때, 특정 형태를 맞추어 보내, 컴퓨터 간에 데이터를 주고 받을 때,
- 네트워크를 통해 전송되는 “데이터 조각”

> Package + Bucket
> 

일반적으로 3~4계층의 데이터 단위를 패킷,

1~2계층의 데이터 단위를 프레임, 이라고 지칭한다

## 패킷의 이해

다른 컴퓨터에 큰 사진을 하나 전송한다고 할때,

큰 사진을 작은 패킷으로 분할하여, 분할된 사진들을 상대방에게 번호를 붙여 전송한다

그리고 상대방은 받은 사진 데이터 조각을 순서대로 나열하여 사진을 복원한다

→ 패킷 교환방식

## 패킷의 구성요소

네트워크 패킷은 헤더, 페이로드, 트레일러 세부분으로 구성된다

### 헤더

- 식별 번호 : 각 패킷에는 두 개의 식별 번호가 있다
    - 첫번째는 “정보 조각이 분할된 패킷 수”
    - 두번째는 완전한 정보의 일부로써 “개별 패킷의 위치”
- 소스 주소 : 패킷을 네트워크로 보내는 장치의 IP 주소
- 대상 주소 : 패킷이 전송되는 IP주소
- 버전 : 사용중인 IP 버전
- TTL(Time to Live) : 패킷이 네트워크에 남아있을 수 있는 생존 시간
    - 이 팻킷을 처리하는 각 라우터가 카운트 “하나 이상” 감소시킨다
- 프로토콜 : IP 패킷의 데이터 부분이 전달되는 전송 계층 프로토콜 TCP or UDP
- 헤더 체크섬 : 헤더가 전송되는 도중 변조되거나 깨지는 경우를 확인하기 위해 사용

### 페이로드

- 패킷에 의해 전송되는 실제 데이터를 나타냄
- 헤더는 목적지에 도달할 때, 패킷에서 제거되므로, 페이로드가 목적지에서 수신하는 유일한 데이터이다

### 트레일러

- 패킷 트레일러의 내용은 각 네트워크 유형에 따라 다르며,
- 일반적으로 트레일러에는 수신 장치에 패킷 끝까지 도달했을을 알리는 몇 비트와
- 모든 패킷이 완전히 수신되었는지 확인할 수 있는 CRC(Cycle Redundancy Check)가 포함되어 있다
    - CRC(순환 중복 검사)는 네트워크를 통하여 데이터를 전송할 때, 전송된 데이터에 오류가 있느지 확인하기 위한 체크값을 결정하는 방식을 의미한다
    - 데이터를 전송하기 전에, 데이터의 값에 따라 CRC값을 계산하여 데이터에 붙여 전송하고,
    - 데이터전송이 끝난후 받은 데이터의 값으로 CRC값을 다시 계산하여, 두 값을 비교한한다
    - 두 값이 다르면, 데이터 전송 과정에서 오류가 덧붙여저 전송된 것을 알수 있다

## 네트워크 패킷 손실의 원인

패킷이 삭제되었거나 전송중에 손실되어 QoE(Quality of Experience, 체감 품질)가 낮아서 대상에 도달할 수 없을 때 발생한다

1. 네트워크 정체
    1. 네트워크가 트래픽으로 정체되어 최대 용량에 도달할 때, 패킷은 전달될 순서를 기다리지만 연결이 너무 느려질 때, 더이상 패킷을 저장할 수 없을 경우, 네트워크가 더이상 정체되는 것을 막기 위해, 패킷이 폐기된다
    2. 현재에는 애플리케이션 레벨에서 데이터를 자동으로 재전송 하거나 전송속도를 늦추어 폐기된 패킷을 정상적으로 처리한다
2. 소프트웨어의 엄격한 테스트 수행 부족, sw update이후 버그 발생
3. 네트워크 스위치 및 라우터 결함, 오래된 네트워크 HW
    1. 패킷 손실과 연결이 끊기기 시작하면, 처리량을 관리할 수 있도록 hw를 수정 및 업데이트 해야한다
4. 보안 위협으로 인한 패킷 손실
    1. 패킷드롭 공격에 의해 발생
    2. 악의적인 공격자는 라우터를 제어하고 패킷을 데이터 스트림에 드롭하는 명령을 보낸다
    3. 네트워크에서 갑자기 높은 비율의 패킷 손실이 발생하면 사이버 공격을 의심해야한다

- 패킷 드롭 공격(Teardrop Attack)
    
    > DoS(denial-of-Service) Teardrop Attack에서 클라이언트는 잘못된 형식의 정보 패킷을 서버로 전송하고, 패킷이 재조립될 때 발생하는 오류를 이용하여 서버의 성능을 저하시킨다
    > 
    
    ### Teardrop Attack 이란?
    
    Teardrop Attack은 DoS (denial-of-service) 공격의 일종으로, 네트워크나 서버에 요청과 데이터를 Flooding하여 컴퓨터 리소스를 사용할 수 없도록 만들려는 공격입니다. 공격자는 조각화된 패킷을 대상 서버로 전송하고 경우에 따라 TCP/IP 취약점이 있으면 서버가 패킷을 재조립할 수 없으며 이로 인하여 서버 과부하가 발생합니다.
    
    Flooding 이란?
    
    - 주어진 시스템이나 네트워크를 지나치게 많은 요청이나 데이터로 넘치게 만드는 공격 기법을 의미한다.
    - 대상 시스템에 대량의 데이터나 요청을 계속 보내어 해당 시스템이 과부하 상태에 빠지도록 공격한다
    
    ### Teardrop Attack이 중요한 이유
    
    legacy 애플리케이션이 여전히 많은 기업에서 오래되거나 패치되지 않은 구식의 운영체제를 사용하는 경우가 많다
    
    이러한 기업은 기업의 주요 시스템을 다운시킬 수 있는 Teardrop Attack에 취약하다
    
    [https://www.f5.com/ko_kr/glossary/teardrop-attack](https://www.f5.com/ko_kr/glossary/teardrop-attack)
    
    [https://doqtqu.tistory.com/228](https://doqtqu.tistory.com/228)
    

## 해결방법

- HW에 결함이 있는 경우, HW를 최대 처리량을 처리할 수 있는 새 어플라이언스로 교체해야한다
- 네트워크 정체가 원인인 경우, 링크의 대역폭 늘리기, 실시간 트래픽에 대해 더 높은 우선순위를 설정할 수 있는 QoS솔루션을 고려할 수 있다

[http://wiki.hash.kr/index.php/패킷](http://wiki.hash.kr/index.php/%ED%8C%A8%ED%82%B7)